# Simulation Examples (Option 2)

This file captures three representative scripts drafted as if generated by the skill. Use it as a quality bar for future
outputs.

## Scenario 1: Read-only snapshot comparison (ad hoc)

```bash
#!/usr/bin/env bash
set -euo pipefail

SRC_DATASET="tank/app"
DST_DATASET="tank_bak/app"

# Optional read-only preflight checks:
zfs list -H -o name "$SRC_DATASET" >/dev/null
zfs list -H -o name "$DST_DATASET" >/dev/null

cmd=(
  bzfs "$SRC_DATASET" "$DST_DATASET"
  --recursive
  --skip-replication
  --compare-snapshot-lists=src+dst+all
  --include-snapshot-regex '.*_(hourly|daily)'
)

printf 'Review command before run:\n'
printf '  %q' "${cmd[@]}"
printf '\n'
"${cmd[@]}"
```

## Scenario 2: Safe destination pruning (state-changing, dry-run default)

```bash
#!/usr/bin/env bash
set -euo pipefail

SRC_DATASET="tank/app"
DST_DATASET="tank_bak/app"
DRYRUN="${DRYRUN:-1}"  # keep 1 for safety

cmd=(
  bzfs "$SRC_DATASET" "$DST_DATASET"
  --recursive
  --skip-replication
  --delete-dst-snapshots
  --include-snapshot-regex '.*_daily'
  --include-snapshot-times-and-ranks "notime" "all except latest 7"
  --include-snapshot-times-and-ranks "anytime..7 days ago"
)

if [[ "$DRYRUN" == "1" ]]; then
  cmd+=(--dryrun)
fi

printf 'Review command before run:\n'
printf '  %q' "${cmd[@]}"
printf '\n'
"${cmd[@]}"
```

## Scenario 3: Periodic jobrunner replication (state-changing, dry-run default)

```bash
#!/usr/bin/env bash
set -euo pipefail

JOBCONFIG="/etc/bzfs/bzfs_job_example.py"
THIS_HOST="$(hostname)"
DRYRUN="${DRYRUN:-1}"  # keep 1 for safety

cmd=("$JOBCONFIG" --dst-host="$THIS_HOST" --replicate --prune-dst-snapshots)

if [[ "$DRYRUN" == "1" ]]; then
  cmd+=(--jobrunner-dryrun --dryrun)
fi

printf 'Review command before run:\n'
printf '  %q' "${cmd[@]}"
printf '\n'
"${cmd[@]}"
```

## Findings from Simulation

1. `DRYRUN`/`dryrun` naming is clearer than negative flags (`NO_DRYRUN`).
2. Read-only tasks do not require `--dryrun`; state-changing tasks do.
3. Optional read-only preflight `zfs list` checks reduce operator mistakes.
4. Python command previews should use `shlex.join(cmd)` for correct quoting.
